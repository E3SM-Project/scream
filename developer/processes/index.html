
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../grid/">
      
      
        <link rel="next" href="../managers/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.42">
    
    
      
        <title>Atmosphere Processes - EAMxx</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#atmospheric-processes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
            
EAMxx is not supported yet.
<a href="https://docs.e3sm.org"> 
  <strong>Please visit docs.e3sm.org for general E3SM documentation.</strong>
</a>

          </div>
          
        </aside>
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="EAMxx" class="md-header__button md-logo" aria-label="EAMxx" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            EAMxx
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Atmosphere Processes
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/E3SM-Project/scream" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="EAMxx" class="md-nav__button md-logo" aria-label="EAMxx" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    EAMxx
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/E3SM-Project/scream" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/eamxx_cases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EAMxx case basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/model_input/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model input
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/model_output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model output
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/nudging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nudging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/clean_clear_sky/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Extra radiation calls
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/cosp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    COSP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/rrm_eamxx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regionally Refined EAMxx
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/dp_eamxx/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Doubly Periodic EAMxx
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developer Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../common/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../style_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Style Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kokkos_ekat/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kokkos and EKAT
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../source_tree/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Tree
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" checked>
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Important Data Structures
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Important Data Structures
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../field/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fields
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../grid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grids and Remappers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Atmosphere Processes
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Atmosphere Processes
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#atmosphere-process-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Atmosphere process interfaces
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../managers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I/O
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Testing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../standalone_testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Standalone
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cime_testing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Full model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci_nightly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI and Nightly Testing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Technical Guide
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Technical Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../technical/aerocom_cldtop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AeroCom cloud top
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#atmosphere-process-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Atmosphere process interfaces
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="atmospheric-processes">Atmospheric Processes</h1>
<p>In EAMxx, <code>AtmosphereProcess</code> (AP) is an abstract class representing a portion of the atmosphere timestep algorithm.
In simple terms, an AP is an object that given certain input fields performs some calculations to compute
some output fields. The concrete AP classes allow to create a buffer layer between particular packages (e.g.,
dynamics dycore, physics parametrizations) and the atmosphere driver (AD), allowing separation of concerns,
so that the AD does not need to know details about the package, and the package does not need to know about
the EAMxx infrastructure.</p>
<p>To enhance this separation of concerns, EAMxx implements two more classes for handling APs:</p>
<ul>
<li>the concrete class <code>AtmosphereProcessGroup</code> (APG), which allows to group together a set of AP's, which can be seen from outside as a single process;</li>
<li>the <code>AtmosphereProcessFactory</code> class, which allows an APG to create its internal processes without any knowledge of
what they are.</li>
</ul>
<p>This infrastructure allows the AD to view the whole atmosphere as a single APG, and to be completely agnostic to
what processes are run, and in which order. This design allows to have a code base that is cleaner, self-container,
and easy to test via a battery of targeted unit tests.</p>
<p>In EAMxx, we already have a few concrete AP's, interfacing the AD to the Hommexx non-hydrostatic dycore as well as
some physics parametrizations (P3, SHOC, RRMTPG, etc). In the next section we describe the interfaces of an AP class,
and we show an example of how to write a new concrete AP class.</p>
<h2 id="atmosphere-process-interfaces">Atmosphere process interfaces</h2>
<p>An AP has several interfaces, which can be grouped into three categories:</p>
<ul>
<li>initialization: these interfaces are used to create the AP, as well as to initialize internal data structures;</li>
<li>run: these interfaces are used to make the AP compute its output fields from its input fields;</li>
<li>finalization: these interfaces are used to perform any clean up operation (e.g., release files) before the AP is
 destroyed.</li>
</ul>
<p>Among the above, the initialization sequence is the most complex, and conists of several steps:</p>
<ul>
<li>The AD creates the APG corresponding to the whole atmosphere. As mentioned above, this phase will make use of a factory,
   which allows the AD to be agnostic to what is actually in the group. All AP's can start performing any initialization
   work that they can, but at this point they are limited to use only an MPI communicator as well as a list of runtime
   parameters (which were previously read from an input file).</li>
<li>The AD passes a <code>GridsManager</code> to the AP's, so that they can get information about the grids they need. At this point,
   all AP's have all the information they need to establish the layout of the input and output fields they need,
   and can store a list of these "requests"</li>
<li>After creating all fields (based on AP's requests), the AD passes a copy of each input and output field to
   the AP's. These fields will be divided in "required" and "computed", which differ in that the former are only
   passed to the AP's as 'read-only' fields (see the <a href="../field/#Field">field</a> documentation for more details)</li>
<li>The AP's are queried for how much scratch memory they may need at run time. After all AP's communicate their needs,
   the AD will provide a pointer to scratch memory to the AP's. This is memory that can be used to initialize
   temporary views/fields or other internal data structures. All AP's are given the same pointer, which means no
   data persistence should be expected at run time between one timestep and the next.</li>
<li>The AD calls the 'initialize' method on each AP. At this point, all fields are set, and AP's can complete any
   remaining initialization task</li>
</ul>
<p>While the base AP class provides an (empty) implementation for some methods, in case derived classes do not need a
feature, some methods are purely virtual, and concrete classes will have to override them. Looking at existing
concrete AP implementations is a good way to have a first idea of what a new AP class needs to implement. Here,
we show go over the possible implementation of these methods in a hypothetical AP class. The header file may
look something like this</p>
<p><div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;share/atm_process/atmosphere_process.hpp&gt;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">MyProcess</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">AtmosphereProcess</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">gm_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">GridsManager</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="n">MyProcess</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ekat</span><span class="o">::</span><span class="n">Comm</span><span class="o">&amp;</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ekat</span><span class="o">::</span><span class="n">ParameterList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pl</span><span class="p">);</span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">name</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;my_fancy_process&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_grids</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">gm_ptr</span><span class="o">&amp;</span><span class="w"> </span><span class="n">grids_manager</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">requested_buffer_size_in_bytes</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">init_buffers</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ATMBufferManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">buffer_manager</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>

<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">initialize_impl</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RunType</span><span class="w"> </span><span class="n">run_type</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">run_impl</span><span class="w">        </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">finalize_impl</span><span class="w">   </span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>

<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">view_1d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">KokkosTypes</span><span class="o">&lt;</span><span class="n">DefaultDevice</span><span class="o">&gt;::</span><span class="n">view_1d</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">view_2d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">KokkosTypes</span><span class="o">&lt;</span><span class="n">DefaultDevice</span><span class="o">&gt;::</span><span class="n">view_2d</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="n">view_1d</span><span class="w"> </span><span class="n">m_temp1</span><span class="p">;</span>
<span class="w">  </span><span class="n">view_2d</span><span class="w"> </span><span class="n">m_temp2</span><span class="p">;</span>

<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">m_ncols</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">m_nlevs</span><span class="p">;</span>
<span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_has_blah</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
A few comments:</p>
<ul>
<li>we added two views to the class, which are meant to be used to store intermediate results during calculations at
runtime;</li>
<li>there are other methods that the class can override (such as additional operations when the AD sets a field in the
   AP), but most AP's only need to override only these;</li>
<li>we strongly encourage to add the keyword <code>override</code> when overriding a method; in case of small typos (e.g., missing
   a <code>&amp;</code> or a <code>const</code>, the compiler will be erroring out, since the signature will not match any virtual method in the
   base class;</li>
<li><code>findalize_impl</code> is often empty; unless the AP is managing external resources, everything should be correctly released
   during destruction;</li>
<li>the two methods for buffers can be omitted if the AP does not need any scratch memory (and the default implementation
   from the base class will be used).</li>
</ul>
<p>Here is a possible implementation of the methods, with some inline comments to explain</p>
<div class="highlight"><pre><span></span><code><span class="n">MyProcess</span><span class="o">::</span><span class="n">MyProcess</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ekat</span><span class="o">::</span><span class="n">Comm</span><span class="o">&amp;</span><span class="w"> </span><span class="n">comm</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">ekat</span><span class="o">::</span><span class="n">ParameterList</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pl</span><span class="p">)</span>
<span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">AtmosphereProcess</span><span class="p">(</span><span class="n">comm</span><span class="p">,</span><span class="n">pl</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// The base class copies pl into protected member m_params</span>
<span class="w">  </span><span class="n">m_has_blah</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_params</span><span class="p">.</span><span class="n">get</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;enable_blah&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">MyProcess</span><span class="o">::</span><span class="n">set_grids</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">GridsManager</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">gm</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">ekat</span><span class="o">::</span><span class="nn">units</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">nondim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Units</span><span class="o">::</span><span class="n">nondimensional</span><span class="p">();</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gm</span><span class="o">-&gt;</span><span class="n">get_grid</span><span class="p">(</span><span class="s">&quot;Physics&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">m_ncols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="o">-&gt;</span><span class="n">get_num_local_dofs</span><span class="p">();</span>
<span class="w">  </span><span class="n">m_nlevs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="o">-&gt;</span><span class="n">get_num_vertical_levels</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// In these names, 2d refers to &quot;horizontal only&quot;, while 3d to &quot;horiz+vert&quot;.</span>
<span class="w">  </span><span class="c1">// But the grid stores dofs linearly, so there is only one array dimension</span>
<span class="w">  </span><span class="n">FieldLayout</span><span class="w"> </span><span class="n">scalar2d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="o">-&gt;</span><span class="n">get_2d_scalar_layout</span><span class="p">();</span>
<span class="w">  </span><span class="n">FieldLayout</span><span class="w"> </span><span class="n">vector3d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="o">-&gt;</span><span class="n">get_3d_vector_layout</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Declare fields needed:</span>
<span class="w">  </span><span class="c1">//  - Required: &#39;input&#39; (read-only)</span>
<span class="w">  </span><span class="c1">//  - Computed: &#39;output&#39;</span>
<span class="w">  </span><span class="c1">//  - Updated: &#39;input&#39;+&#39;output&#39;</span>
<span class="w">  </span><span class="c1">// Tell the AD we need &#39;velocity&#39; to accommodate a Pack scalar type</span>
<span class="w">  </span><span class="n">add_field</span><span class="o">&lt;</span><span class="n">Required</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;coeff_2d&quot;</span><span class="p">,</span><span class="n">scalar2d</span><span class="p">,</span><span class="n">nondim</span><span class="p">,</span><span class="n">grid</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="w">  </span><span class="n">add_field</span><span class="o">&lt;</span><span class="n">Updated</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;velocity&quot;</span><span class="p">,</span><span class="n">vector3d</span><span class="p">,</span><span class="n">m</span><span class="o">/</span><span class="n">s</span><span class="p">,</span><span class="n">grid</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="n">SCREAM_PACK_SIZE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">size_t</span><span class="w"> </span><span class="n">MyProcess</span><span class="o">::</span><span class="n">requested_buffer_size_in_bytes</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// We use temp2 only if the blah feature is on</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">m_ncols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">m_has_blah</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">m_ncols</span><span class="o">*</span><span class="n">m_nlev</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">MyProcess</span><span class="o">::</span><span class="n">init_buffers</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ATMBufferManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">buffer_manager</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">buffer_manager</span><span class="p">.</span><span class="n">get_memory</span><span class="p">());</span>

<span class="w">  </span><span class="n">m_temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view_1d</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span><span class="n">m_ncols</span><span class="p">);</span>
<span class="w">  </span><span class="n">mem</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_ncols</span><span class="p">;</span>

<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_has_blah</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">m_temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">view_2d</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span><span class="p">(</span><span class="n">mem</span><span class="p">,</span><span class="n">m_ncols</span><span class="p">,</span><span class="n">m_nlevs</span><span class="p">);</span>
<span class="w">    </span><span class="n">mem</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">m_ncols</span><span class="o">*</span><span class="n">m_nlevs</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// Make sure we use exactly the mem we said we would</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">used_mem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">mem</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">buffer_manager</span><span class="p">.</span><span class="n">get_memory</span><span class="p">())</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="n">Real</span><span class="p">);</span>
<span class="w">  </span><span class="n">EKAT_REQUIRE_MSG</span><span class="p">(</span><span class="n">used_mem</span><span class="o">==</span><span class="n">requested_buffer_size_in_bytes</span><span class="p">(),</span>
<span class="w">    </span><span class="s">&quot;Error! Used memory != requested memory for MyProcess.&quot;</span>
<span class="w">    </span><span class="s">&quot;  used memory: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">used_mem</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="w">    </span><span class="s">&quot;  requested: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">requested_buffer_size_in_bytes</span><span class="p">())</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">MyProcess</span><span class="o">::</span><span class="n">initialize_impl</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">RunType</span><span class="w"> </span><span class="n">run_type</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// Can complete any initialization of the background pkg</span>
<span class="w">  </span><span class="n">my_process_pkg_init</span><span class="p">(</span><span class="n">m_has_blah</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">MyProcess</span><span class="o">:</span><span class="n">run_impl</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">KokkosTypes</span><span class="o">&lt;</span><span class="n">DefaultDevice</span><span class="o">&gt;::</span><span class="n">TeamPolicy</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">Member</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">KokkosTypes</span><span class="o">&lt;</span><span class="n">DefaultDevice</span><span class="o">&gt;::</span><span class="n">MemberType</span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">PackT</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">ekat</span><span class="o">::</span><span class="n">Pack</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">,</span><span class="n">SCREAM_PACK_SIZE</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Create team policy</span>
<span class="w">  </span><span class="n">Policy</span><span class="w"> </span><span class="nf">policy</span><span class="p">(</span><span class="n">m_ncols</span><span class="p">,</span><span class="n">m_nlevs</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Create local copies of class members (or else use KOKKOS_CLASS_LAMBDA)</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_temp1</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">temp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_temp2</span><span class="p">;</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">do_blah</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_has_blah</span><span class="p">;</span>

<span class="w">  </span><span class="c1">// Get views from fields. We </span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">coeff2d</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">get_field_in</span><span class="p">(</span><span class="s">&quot;coeff_2d&quot;</span><span class="p">).</span><span class="n">get_view</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">Real</span><span class="o">*&gt;</span><span class="p">();</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_field_out</span><span class="p">(</span><span class="s">&quot;velocity&quot;</span><span class="p">).</span><span class="n">get_view</span><span class="o">&lt;</span><span class="n">PackT</span><span class="o">**&gt;</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// Since we process velocity with a Pack scalar type, find out how many packs</span>
<span class="w">  </span><span class="c1">// we have in each column</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">nlevs_packs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ekat</span><span class="o">::</span><span class="n">PackInfo</span><span class="o">&lt;</span><span class="n">SCREAM_PACK_SIZE</span><span class="o">&gt;::</span><span class="n">num_packs</span><span class="p">(</span><span class="n">m_nlevs</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Call some function in the background pkg</span>
<span class="w">  </span><span class="n">do_some_work</span><span class="w"> </span><span class="p">(</span><span class="n">coeff_2d</span><span class="p">,</span><span class="n">velocity</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">do_blah</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// Do some more work here</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">KOKKOS_LAMBDA</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Member</span><span class="o">&amp;</span><span class="w"> </span><span class="n">team</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">icol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">team</span><span class="p">.</span><span class="n">league_rank</span><span class="p">();</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">col_work</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">ilev</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="n">velocity</span><span class="p">(</span><span class="n">icol</span><span class="p">,</span><span class="n">ilev</span><span class="p">)</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">coeff_2d</span><span class="p">;</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span><span class="n">Kokkos</span><span class="o">::</span><span class="n">TeamVectorRange</span><span class="p">(</span><span class="n">team</span><span class="p">,</span><span class="n">nlevs_packs</span><span class="p">),</span><span class="n">col_work</span><span class="p">);</span>
<span class="w">  </span><span class="p">};</span>
<span class="w">  </span><span class="n">Kokkos</span><span class="o">::</span><span class="n">parallel_for</span><span class="p">(</span><span class="n">policy</span><span class="p">,</span><span class="n">work</span><span class="p">);</span>
<span class="w">  </span><span class="n">Kokkos</span><span class="o">::</span><span class="n">fence</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">MyProcess</span><span class="o">::</span><span class="n">finalize_impl</span><span class="w"> </span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="c1">// If the background package needs to cleanup something, do it now</span>
<span class="w">  </span><span class="n">my_process_pkg_cleanup</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indices", "navigation.instant", "navigation.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>